
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Virginia Legends Cricket</title>
<style>
    :root {
      --primary: #3a6ea5;
      --primary-dark: #214f7a;
      --success: #28a745;
      --danger: #dc3545;
      --info: #007bff;
      --bg: #eef2f7;
      --highlight: #d1ecf1;
      --text: #333;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 10px;
    }

    h1 {
      text-align: center;
      margin: 20px 0;
    }

    .tab-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      position: sticky;
      top: 0;
      background: var(--bg);
      z-index: 10;
      padding: 10px 0;
      border-bottom: 1px solid #ccc;
    }

    .tab {
      padding: 10px 16px;
      margin: 5px;
      border-radius: 4px;
      color: white;
      background: var(--primary);
      cursor: pointer;
    }

    .tab.active {
      background: var(--primary-dark);
    }

    input, .btn {
      font-size: 1em;
      margin: 4px 0;
      padding: 6px;
      width: 100%;
      box-sizing: border-box;
    }

    input {
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .btn {
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn.submit { background: var(--success); color: white; }
    .btn.clear { background: var(--danger); color: white; }
    .btn.export { background: var(--info); color: white; }

    .match-input > div {
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 12px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      overflow-x: auto;
      display: block;
    }

    th, td {
      padding: 8px;
      border: 1px solid #bbb;
      text-align: center;
    }

    th {
      background: var(--primary);
      color: white;
    }

    .highlight {
      background: var(--highlight);
    }

    .button-row {
      text-align: center;
      margin: 20px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .team-group, .group-table {
      margin: 20px auto;
      max-width: 700px;
    }

    .result-summary {
      margin-top: 8px;
      font-size: 0.9em;
      color: var(--text);
    }

    @media (max-width: 600px) {
      input, .btn { font-size: 0.9em; }
      .match-input > div { padding: 10px; }
    }
  </style>
</head>
<body>
<h1>Virginia Legends Cricket</h1>
<div class="tab-container" id="tabs"></div>
<div id="teamInputs"></div>
<div class="match-input" id="matchInputs"></div>
<div class="button-row">
<button class="btn clear" onclick="clearAll()">Clear All Data</button>
<button class="btn export" onclick="exportCSV()">Upload to Web</button>
<button class="btn export" onclick="exportMatches()">Export Match Scores</button></div>
<div id="tables"></div>
<script>

    const groups = ['A','B','C','D'];
    let teamData = {}, stats = {};

    function saveData() {
      localStorage.setItem('vl6s_data', JSON.stringify({ teamData, stats }));
    }

    function loadData() {
      const data = localStorage.getItem('vl6s_data');
      if (data) {
        const obj = JSON.parse(data);
        teamData = obj.teamData;
        stats = obj.stats;
      } else {
        groups.forEach(g => {
          teamData[g] = Array(4).fill().map((_, i) => `Team ${g}${i+1}`);
          stats[g] = {};
          teamData[g].forEach((_, i) => stats[g][i] = { m:0, w:0, l:0, t:0, rf:0, rof:0, ra:0, roa:0 });
        });
      }
    }

    function clearAll() {
      localStorage.removeItem('vl6s_data');
      location.reload();
    }

    function exportCSV() {
      let csv = 'Group,Team,Mat,W,L,T,NRR,Points\n';
      groups.forEach(g => {
        teamData[g].forEach((name, i) => {
          const s = stats[g][i];
          const pts = s.w*2 + s.t;
          const nrr = (s.rof && s.roa) ? ((s.rf/s.rof)-(s.ra/s.roa)).toFixed(3) : '0.000';
          csv += `${g},${name},${s.m},${s.w},${s.l},${s.t},${nrr},${pts}\n`;
        });
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'tournament_results.csv';
      a.click();
    }

    function init() {
      loadData();
      renderTabs();
      renderInputs();
      renderMatches();
      renderTables();
      const resultEl = document.getElementById(`result_${g}_${i}_${j}`);
      if (resultEl) {
        let summary = `<strong>ğŸ“Š Result:</strong><br>`;
        summary += `${teamData[g][i]} ${r1}/${w1} (${convertOversToDecimal(o1).toFixed(3)} overs)<br>`;
        summary += `${teamData[g][j]} ${r2}/${w2} (${convertOversToDecimal(o2).toFixed(3)} overs)<br>`;
        if (r1 > r2) summary += `<strong>ğŸ† Winner:</strong> ${teamData[g][i]}`;
        else if (r2 > r1) summary += `<strong>ğŸ† Winner:</strong> ${teamData[g][j]}`;
        else summary += `<strong>ğŸ¤ Match tied</strong>`;
        resultEl.innerHTML = summary;
      }
    
    }

    function renderTabs() {
      const el = document.getElementById('tabs');
      el.innerHTML = '';
      groups.forEach((g, i) => {
        const div = document.createElement('div');
        div.className = 'tab' + (i === 0 ? ' active' : '');
        div.textContent = 'Group ' + g;
        div.onclick = () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          div.classList.add('active');
          renderTables(); document.getElementById(`group_${g}`).scrollIntoView({ behavior: 'smooth' });
        };
        el.appendChild(div);
      });
    }

    function renderInputs() {
      const el = document.getElementById('teamInputs');
      el.innerHTML = '';
      groups.forEach(g => {
        const sec = document.createElement('div');
        sec.innerHTML = `<h3>Group ${g}</h3>`;
        teamData[g].forEach((name, i) => {
          const inp = document.createElement('input');
          inp.value = name;
          inp.oninput = () => {
            teamData[g][i] = inp.value || `Team ${g}${i+1}`;
            saveData(); renderMatches(); renderTables();
      const resultEl = document.getElementById(`result_${g}_${i}_${j}`);
      if (resultEl) {
        let summary = `<strong>ğŸ“Š Result:</strong><br>`;
        summary += `${teamData[g][i]} ${r1}/${w1} (${convertOversToDecimal(o1).toFixed(3)} overs)<br>`;
        summary += `${teamData[g][j]} ${r2}/${w2} (${convertOversToDecimal(o2).toFixed(3)} overs)<br>`;
        if (r1 > r2) summary += `<strong>ğŸ† Winner:</strong> ${teamData[g][i]}`;
        else if (r2 > r1) summary += `<strong>ğŸ† Winner:</strong> ${teamData[g][j]}`;
        else summary += `<strong>ğŸ¤ Match tied</strong>`;
        resultEl.innerHTML = summary;
      }
    
          };
          sec.appendChild(inp);
        });
        el.appendChild(sec);
      });
    }

    function renderMatches() {
      const el = document.getElementById('matchInputs');
      el.innerHTML = '';
      groups.forEach(g => {
        for (let i=0;i<4;i++) {
          for (let j=i+1;j<4;j++) {
            const div = document.createElement('div');
            div.innerHTML = `<div id='result_${g}_${i}_${j}' style='margin-top: 8px; font-size: 0.9em; color: #333;'></div>` + `
              <strong>${teamData[g][i]} vs ${teamData[g][j]}</strong><br>
              ${teamData[g][i]} Runs: <input id='${g}_${i}_${j}_r1' type='number'><br>Wickets: <input id='${g}_${i}_${j}_w1' type='number'><br>
              Overs: <input id='${g}_${i}_${j}_o1' type='number'><br>
              ${teamData[g][j]} Runs: <input id='${g}_${i}_${j}_r2' type='number'><br>Wickets: <input id='${g}_${i}_${j}_w2' type='number'><br>
              Overs: <input id='${g}_${i}_${j}_o2' type='number'><br>
              <button class='btn submit' onclick="submit('${g}',${i},${j})">Submit</button>
<button class='btn clear' onclick="clearMatch('${g}',${i},${j})">Clear</button>
            `;
            el.appendChild(div);
          }
        }
      });
    }

    function convertOversToDecimal(overs) {
  const full = Math.floor(overs);
  const balls = Math.round((overs - full) * 10);
  return full + (balls / 6);
}

function clearMatch(g, i, j) {
  const r1El = document.getElementById(`${g}_${i}_${j}_r1`);
  const o1El = document.getElementById(`${g}_${i}_${j}_o1`);
  const w1El = document.getElementById(`${g}_${i}_${j}_w1`);
  const r2El = document.getElementById(`${g}_${i}_${j}_r2`);
  const o2El = document.getElementById(`${g}_${i}_${j}_o2`);
  const w2El = document.getElementById(`${g}_${i}_${j}_w2`);

  // Parse values
  const r1 = +r1El.value, o1 = +o1El.value, w1 = +w1El.value;
  const r2 = +r2El.value, o2 = +o2El.value, w2 = +w2El.value;

  // Determine if match was previously submitted by checking if submit button is disabled
  const submitBtn = document.querySelector(`button[onclick="submit('${g}',${i},${j})"]`);
  const wasSubmitted = submitBtn && submitBtn.disabled;

  if (wasSubmitted && ![r1, o1, r2, o2, w1, w2].some(isNaN)) {
    const t1 = stats[g][i];
    const t2 = stats[g][j];

    t1.m--; t2.m--;
    t1.rf -= r1; t1.rof -= convertOversToDecimal(o1); t1.ra -= r2; t1.roa -= convertOversToDecimal(o2);
    t2.rf -= r2; t2.rof -= convertOversToDecimal(o2); t2.ra -= r1; t2.roa -= convertOversToDecimal(o1);

    if (r1 > r2) { t1.w--; t2.l--; }
    else if (r2 > r1) { t2.w--; t1.l--; }
    else { t1.t--; t2.t--; }
  }

  // Clear fields
  [r1El, o1El, w1El, r2El, o2El, w2El].forEach(el => { if (el) el.value = ''; });

  // Clear result summary
  const res = document.getElementById(`result_${g}_${i}_${j}`);
  if (res) res.innerHTML = '';

  // Re-enable submit
  if (submitBtn) submitBtn.disabled = false;

  saveData();
  renderTables();
}

function submit(g, i, j) {
  const submitBtn = document.querySelector(`button[onclick="submit('${g}',${i},${j})"]`);
  if (submitBtn) submitBtn.disabled = true;

      const r1 = +document.getElementById(`${g}_${i}_${j}_r1`).value;
      const o1 = +document.getElementById(`${g}_${i}_${j}_o1`).value;
      const r2 = +document.getElementById(`${g}_${i}_${j}_r2`).value;
const w1 = +document.getElementById(`${g}_${i}_${j}_w1`).value;
const w2 = +document.getElementById(`${g}_${i}_${j}_w2`).value;
      const o2 = +document.getElementById(`${g}_${i}_${j}_o2`).value;
      if ([r1, o1, r2, o2].some(isNaN)) return alert('Enter all values');
      const t1 = stats[g][i], t2 = stats[g][j];
      t1.m++; t2.m++;
      t1.rf += r1; t1.rof += convertOversToDecimal(o1); t1.ra += r2; t1.roa += convertOversToDecimal(o2);
      t2.rf += r2; t2.rof += convertOversToDecimal(o2); t2.ra += r1; t2.roa += convertOversToDecimal(o1);
      if (r1 > r2) { t1.w++; t2.l++; }
      else if (r2 > r1) { t2.w++; t1.l++; }
      else { t1.t++; t2.t++; }
      saveData(); renderTables();
      const resultEl = document.getElementById(`result_${g}_${i}_${j}`);
      if (resultEl) {
        let summary = `<strong>ğŸ“Š Result:</strong><br>`;
        summary += `${teamData[g][i]} ${r1}/${w1} (${convertOversToDecimal(o1).toFixed(3)} overs)<br>`;
        summary += `${teamData[g][j]} ${r2}/${w2} (${convertOversToDecimal(o2).toFixed(3)} overs)<br>`;
        if (r1 > r2) summary += `<strong>ğŸ† Winner:</strong> ${teamData[g][i]}`;
        else if (r2 > r1) summary += `<strong>ğŸ† Winner:</strong> ${teamData[g][j]}`;
        else summary += `<strong>ğŸ¤ Match tied</strong>`;
        resultEl.innerHTML = summary;
      }
    
    }

    function renderTables(active = 'A') {
      const el = document.getElementById('tables');
      el.innerHTML = '';
      groups.forEach(g => {
        const list = teamData[g].map((name, i) => {
          const s = stats[g][i], pts = s.w*2 + s.t;
          const nrr = s.rof && s.roa ? ((s.rf/s.rof)-(s.ra/s.roa)).toFixed(3) : '0.000';
          return { name, ...s, pts, nrr };
        }).sort((a,b)=>b.pts - a.pts || b.nrr - a.nrr);
        const table = `<h3>Group ${g}</h3><table>
        <tr><th>Team</th><th>Mat</th><th>W</th><th>L</th><th>T</th><th>NRR</th><th>Pts</th></tr>
        ${list.map((t,i)=>`<tr class='${i<2?'highlight':''}'><td>${t.name}</td><td>${t.m}</td><td>${t.w}</td><td>${t.l}</td><td>${t.t}</td><td>${t.nrr}</td><td>${t.pts}</td></tr>`).join('')}
        </table>`;
        const sec = document.createElement('div');
        sec.style.display = 'block';
        sec.innerHTML = table;
        el.appendChild(sec);
      });
    }

    window.onload = init;
  

let matchResults = {};

function saveData() {
  localStorage.setItem('vl6s_data', JSON.stringify({ teamData, stats, matchResults }));
}

function loadData() {
  const data = localStorage.getItem('vl6s_data');
  if (data) {
    const obj = JSON.parse(data);
    teamData = obj.teamData;
    stats = obj.stats;
    matchResults = obj.matchResults || {};
  } else {
    groups.forEach(g => {
      teamData[g] = Array(4).fill().map((_, i) => `Team ${g}${i+1}`);
      stats[g] = {};
      teamData[g].forEach((_, i) => stats[g][i] = { m:0, w:0, l:0, t:0, rf:0, rof:0, ra:0, roa:0 });
    });
  }
}

function submit(g, i, j) {
  const submitBtn = document.querySelector(`button[onclick="submit('${g}',${i},${j})"]`);
  if (submitBtn) submitBtn.disabled = true;

  const r1 = +document.getElementById(`${g}_${i}_${j}_r1`).value;
  const o1 = +document.getElementById(`${g}_${i}_${j}_o1`).value;
  const r2 = +document.getElementById(`${g}_${i}_${j}_r2`).value;
  const w1 = +document.getElementById(`${g}_${i}_${j}_w1`).value;
  const w2 = +document.getElementById(`${g}_${i}_${j}_w2`).value;
  const o2 = +document.getElementById(`${g}_${i}_${j}_o2`).value;
  if ([r1, o1, r2, o2, w1, w2].some(isNaN)) return alert('Enter all values');

  const t1 = stats[g][i], t2 = stats[g][j];
  t1.m++; t2.m++;
  t1.rf += r1; t1.rof += convertOversToDecimal(o1); t1.ra += r2; t1.roa += convertOversToDecimal(o2);
  t2.rf += r2; t2.rof += convertOversToDecimal(o2); t2.ra += r1; t2.roa += convertOversToDecimal(o1);
  if (r1 > r2) { t1.w++; t2.l++; }
  else if (r2 > r1) { t2.w++; t1.l++; }
  else { t1.t++; t2.t++; }

  matchResults[`${g}_${i}_${j}`] = { r1, w1, o1, r2, w2, o2 };

  saveData(); renderTables();
  const resultEl = document.getElementById(`result_${g}_${i}_${j}`);
  if (resultEl) {
    let summary = `<strong>ğŸ“Š Result:</strong><br>`;
    summary += `${teamData[g][i]} ${r1}/${w1} (${convertOversToDecimal(o1).toFixed(3)} overs)<br>`;
    summary += `${teamData[g][j]} ${r2}/${w2} (${convertOversToDecimal(o2).toFixed(3)} overs)<br>`;
    if (r1 > r2) summary += `<strong>ğŸ† Winner:</strong> ${teamData[g][i]}`;
    else if (r2 > r1) summary += `<strong>ğŸ† Winner:</strong> ${teamData[g][j]}`;
    else summary += `<strong>ğŸ¤ Match tied</strong>`;
    resultEl.innerHTML = summary;
  }
}

function clearMatch(g, i, j) {
  const key = `${g}_${i}_${j}`;
  const existing = matchResults[key];
  if (existing) {
    const t1 = stats[g][i], t2 = stats[g][j];
    t1.m--; t2.m--;
    t1.rf -= existing.r1; t1.rof -= convertOversToDecimal(existing.o1); t1.ra -= existing.r2; t1.roa -= convertOversToDecimal(existing.o2);
    t2.rf -= existing.r2; t2.rof -= convertOversToDecimal(existing.o2); t2.ra -= existing.r1; t2.roa -= convertOversToDecimal(existing.o1);
    if (existing.r1 > existing.r2) { t1.w--; t2.l--; }
    else if (existing.r2 > existing.r1) { t2.w--; t1.l--; }
    else { t1.t--; t2.t--; }
    delete matchResults[key];
  }

  [r1El, o1El, w1El, r2El, o2El, w2El] = ['r1','o1','w1','r2','o2','w2'].map(x => 
    document.getElementById(`${g}_${i}_${j}_${x}`)
  );
  [r1El, o1El, w1El, r2El, o2El, w2El].forEach(el => { if (el) el.value = ''; });

  const res = document.getElementById(`result_${g}_${i}_${j}`);
  if (res) res.innerHTML = '';

  const submitBtn = document.querySelector(`button[onclick="submit('${g}',${i},${j})"]`);
  if (submitBtn) submitBtn.disabled = false;

  saveData();
  renderTables();
}

function exportMatches() {
  let csv = 'Group,Team1,Team1 Runs,Wickets,Overs,Team2,Team2 Runs,Wickets,Overs,Result\n';
  Object.keys(matchResults).forEach(key => {
    const [g, i, j] = key.split('_');
    const { r1, w1, o1, r2, w2, o2 } = matchResults[key];
    const team1 = teamData[g][i];
    const team2 = teamData[g][j];
    let result = 'Tie';
    if (r1 > r2) result = `${team1} won`;
    else if (r2 > r1) result = `${team2} won`;
    csv += `${g},${team1},${r1},${w1},${o1.toFixed(1)},${team2},${r2},${w2},${o2.toFixed(1)},${result}\n`;
  });

  const blob = new Blob([csv], { type: 'text/csv' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'match_scores.csv';
  a.click();
}

</script>
</body>
</html>